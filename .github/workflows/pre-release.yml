name: pre-release

on:
  create

jobs:

  update-versions:

    if: contains(github.ref, 'release-v') && contains(github.event.sender.login, 'ebebbington')

    runs-on: ubuntu-latest

    steps:

      - name: Checkout master
        uses: actions/checkout@v2
        with:
          ref: master

      - name: Delete Remote Release Branch
        run: git push --delete origin ${{ github.ref }}

      - name: Install Deno
        uses: denolib/setup-deno@v2

      - name: Bump Versions
        run: deno run -A ./bump_versions.ts --version=${{ github.ref }}

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v2
        with:
          token: ${{ secrets.CI_USER_PAT }}
          commit-message: bump versions
          title: bump versions
          body: This was auto-generated by GitHub Actions.
          branch: release # Can change it to ${{ github.ref }} to be the branch name, but then we need to figure out how to stop this worjflow running  when it creates another "release-vx.x.x" branc